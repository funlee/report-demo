(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-618a3caa"],{"18c2":function(e,t,n){"use strict";var o=n("4ea4"),a=n("dbce");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n("ab5b")),r=(0,o(n("f3f8")).default)(i.createElement("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"}),"MoreHoriz");t.default=r},5032:function(e,t,n){"use strict";n.r(t);var o=n("ab5b"),a=n.n(o),i=n("2ef0"),r=n("8776"),c=n("34a4"),s=n("c31d"),l=n("15fd"),u=(n("4cec"),n("d7bc"),n("8ae8")),d=n("c295"),p=n("1f64"),f=n("3835"),m=n("751b"),b=n("b6bd"),v=n("e07c"),y=n("6df1"),O={entering:{transform:"none"},entered:{transform:"none"}},g={enter:d.b.enteringScreen,exit:d.b.leavingScreen},E=o.forwardRef((function(e,t){var n=e.children,a=e.disableStrictModeCompat,i=void 0!==a&&a,r=e.in,c=e.onEnter,u=e.onEntered,d=e.onEntering,p=e.onExit,E=e.onExited,j=e.onExiting,h=e.style,x=e.timeout,I=void 0===x?g:x,T=e.TransitionComponent,w=void 0===T?m.a:T,D=Object(l.a)(e,["children","disableStrictModeCompat","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"]),C=Object(b.a)(),k=C.unstable_strictMode&&!i,_=o.useRef(null),L=Object(y.a)(n.ref,t),N=Object(y.a)(k?_:void 0,L),S=function(e){return function(t,n){if(e){var o=k?[_.current,t]:[t,n],a=Object(f.a)(o,2),i=a[0],r=a[1];void 0===r?e(i):e(i,r)}}},R=S(d),M=S((function(e,t){Object(v.b)(e);var n=Object(v.a)({style:h,timeout:I},{mode:"enter"});e.style.webkitTransition=C.transitions.create("transform",n),e.style.transition=C.transitions.create("transform",n),c&&c(e,t)})),P=S(u),F=S(j),z=S((function(e){var t=Object(v.a)({style:h,timeout:I},{mode:"exit"});e.style.webkitTransition=C.transitions.create("transform",t),e.style.transition=C.transitions.create("transform",t),p&&p(e)})),B=S(E);return o.createElement(w,Object(s.a)({appear:!0,in:r,nodeRef:k?_:void 0,onEnter:M,onEntered:P,onEntering:R,onExit:z,onExited:B,onExiting:F,timeout:I},D),(function(e,t){return o.cloneElement(n,Object(s.a)({style:Object(s.a)({transform:"scale(0)",visibility:"exited"!==e||r?void 0:"hidden"},O[e],h,n.props.style),ref:N},t))}))})),j=n("5d7d"),h=n("36ab"),x=n("b9c0");function I(e){return"up"===e||"down"===e?"vertical":"right"===e||"left"===e?"horizontal":void 0}var T=o.forwardRef((function(e,t){var n=e.ariaLabel,a=e.FabProps,i=(a=void 0===a?{}:a).ref,r=Object(l.a)(a,["ref"]),c=e.children,p=e.classes,f=e.className,m=e.direction,b=void 0===m?"up":m,v=e.hidden,O=void 0!==v&&v,g=e.icon,T=e.onBlur,w=e.onClose,D=e.onFocus,C=e.onKeyDown,k=e.onMouseEnter,_=e.onMouseLeave,L=e.onOpen,N=e.open,S=(e.openIcon,e.TransitionComponent),R=void 0===S?E:S,M=e.transitionDuration,P=void 0===M?{enter:d.b.enteringScreen,exit:d.b.leavingScreen}:M,F=e.TransitionProps,z=Object(l.a)(e,["ariaLabel","FabProps","children","classes","className","direction","hidden","icon","onBlur","onClose","onFocus","onKeyDown","onMouseEnter","onMouseLeave","onOpen","open","openIcon","TransitionComponent","transitionDuration","TransitionProps"]),B=o.useRef();o.useEffect((function(){return function(){clearTimeout(B.current)}}),[]);var $=o.useRef(0),V=o.useRef(),A=o.useRef([]);A.current=[A.current[0]];var J=o.useCallback((function(e){A.current[0]=e}),[]),K=Object(y.a)(i,J),W=function(e,t){return function(n){A.current[e+1]=n,t&&t(n)}};o.useEffect((function(){N||($.current=0,V.current=void 0)}),[N]);var H=function(e){"mouseleave"===e.type&&_&&_(e),"blur"===e.type&&T&&T(e),clearTimeout(B.current),w&&("blur"===e.type?(e.persist(),B.current=setTimeout((function(){w(e,"blur")}))):w(e,"mouseLeave"))},X=function(e){"mouseenter"===e.type&&k&&k(e),"focus"===e.type&&D&&D(e),clearTimeout(B.current),L&&!N&&(e.persist(),B.current=setTimeout((function(){L(e,{focus:"focus",mouseenter:"mouseEnter"}[e.type])})))},q=n.replace(/^[^a-z]+|[^\w:.-]+/gi,""),G=o.Children.toArray(c).filter((function(e){return o.isValidElement(e)})),U=G.map((function(e,t){var n=e.props.FabProps,a=(n=void 0===n?{}:n).ref,i=Object(l.a)(n,["ref"]);return o.cloneElement(e,{FabProps:Object(s.a)({},i,{ref:W(t,a)}),delay:30*(N?t:G.length-t),open:N,id:"".concat(q,"-action-").concat(t)})}));return o.createElement("div",Object(s.a)({className:Object(u.a)(p.root,p["direction".concat(Object(h.a)(b))],f),ref:t,role:"presentation",onKeyDown:function(e){C&&C(e);var t,n,o,a=e.key.replace("Arrow","").toLowerCase(),i=V.current,r=void 0===i?a:i;if("Escape"!==e.key){if(I(a)===I(r)&&void 0!==I(a)){e.preventDefault();var c=a===r?1:-1,s=(t=$.current+c,n=0,o=A.current.length-1,t<n?n:t>o?o:t);A.current[s].focus(),$.current=s,V.current=r}}else w&&(A.current[0].focus(),w(e,"escapeKeyDown"))},onBlur:H,onFocus:X,onMouseEnter:X,onMouseLeave:H},z),o.createElement(R,Object(s.a)({in:!O,timeout:P,unmountOnExit:!0},F),o.createElement(j.a,Object(s.a)({color:"primary","aria-label":n,"aria-haspopup":"true","aria-expanded":N,"aria-controls":"".concat(q,"-actions")},r,{onClick:function(e){r.onClick&&r.onClick(e),clearTimeout(B.current),N?w&&w(e,"toggle"):L&&L(e,"toggle")},className:Object(u.a)(p.fab,r.className),ref:K}),o.isValidElement(g)&&Object(x.a)(g,["SpeedDialIcon"])?o.cloneElement(g,{open:N}):g)),o.createElement("div",{id:"".concat(q,"-actions"),role:"menu","aria-orientation":I(b),className:Object(u.a)(p.actions,!N&&p.actionsClosed)},U))})),w=Object(p.a)((function(e){return{root:{zIndex:e.zIndex.speedDial,display:"flex",alignItems:"center",pointerEvents:"none"},fab:{pointerEvents:"auto"},directionUp:{flexDirection:"column-reverse","& $actions":{flexDirection:"column-reverse",marginBottom:-32,paddingBottom:48}},directionDown:{flexDirection:"column","& $actions":{flexDirection:"column",marginTop:-32,paddingTop:48}},directionLeft:{flexDirection:"row-reverse","& $actions":{flexDirection:"row-reverse",marginRight:-32,paddingRight:48}},directionRight:{flexDirection:"row","& $actions":{flexDirection:"row",marginLeft:-32,paddingLeft:48}},actions:{display:"flex",pointerEvents:"auto"},actionsClosed:{transition:"top 0s linear 0.2s",pointerEvents:"none"}}}),{name:"MuiSpeedDial"})(T),D=n("e402"),C=Object(D.a)(o.createElement("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add"),k=o.forwardRef((function(e,t){var n=e.className,a=e.classes,i=e.icon,r=e.open,c=e.openIcon,d=Object(l.a)(e,["className","classes","icon","open","openIcon"]),p=Object(u.a)(a.icon,r&&[a.iconOpen,c&&a.iconWithOpenIconOpen]),f=Object(u.a)(a.openIcon,r&&a.openIconOpen);function m(e,t){return o.isValidElement(e)?o.cloneElement(e,{className:t}):e}return o.createElement("span",Object(s.a)({className:Object(u.a)(a.root,n),ref:t},d),c?m(c,f):null,i?m(i,p):o.createElement(C,{className:p}))}));k.muiName="SpeedDialIcon";var _=Object(p.a)((function(e){return{root:{height:24},icon:{transition:e.transitions.create(["transform","opacity"],{duration:e.transitions.duration.short})},iconOpen:{transform:"rotate(45deg)"},iconWithOpenIconOpen:{opacity:0},openIcon:{position:"absolute",transition:e.transitions.create(["transform","opacity"],{duration:e.transitions.duration.short}),opacity:0,transform:"rotate(-45deg)"},openIconOpen:{transform:"rotate(0deg)",opacity:1}}}),{name:"MuiSpeedDialIcon"})(k),L=n("c9ef"),N=n("72c7"),S=o.forwardRef((function(e,t){var n=e.classes,a=e.className,i=e.delay,r=void 0===i?0:i,c=e.FabProps,d=void 0===c?{}:c,p=e.icon,f=e.id,m=e.open,b=e.TooltipClasses,v=e.tooltipOpen,y=void 0!==v&&v,O=e.tooltipPlacement,g=void 0===O?"left":O,E=e.tooltipTitle,x=Object(l.a)(e,["classes","className","delay","FabProps","icon","id","open","TooltipClasses","tooltipOpen","tooltipPlacement","tooltipTitle"]),I=o.useState(y),T=I[0],w=I[1],D={transitionDelay:"".concat(r,"ms")},C=o.createElement(j.a,Object(s.a)({size:"small",className:Object(u.a)(n.fab,a,!m&&n.fabClosed),tabIndex:-1,role:"menuitem","aria-describedby":"".concat(f,"-label")},d,{style:Object(s.a)({},D,d.style)}),p);return y?o.createElement("span",Object(s.a)({id:f,ref:t,className:Object(u.a)(n.staticTooltip,n["tooltipPlacement".concat(Object(h.a)(g))],!m&&n.staticTooltipClosed)},x),o.createElement("span",{style:D,id:"".concat(f,"-label"),className:n.staticTooltipLabel},E),C):o.createElement(N.a,Object(s.a)({id:f,ref:t,title:E,placement:g,onClose:function(){w(!1)},onOpen:function(){w(!0)},open:m&&T,classes:b},x),C)})),R=Object(p.a)((function(e){return{fab:{margin:8,color:e.palette.text.secondary,backgroundColor:e.palette.background.paper,"&:hover":{backgroundColor:Object(L.b)(e.palette.background.paper,.15)},transition:"".concat(e.transitions.create("transform",{duration:e.transitions.duration.shorter}),", opacity 0.8s"),opacity:1},fabClosed:{opacity:0,transform:"scale(0)"},staticTooltip:{position:"relative",display:"flex","& $staticTooltipLabel":{transition:e.transitions.create(["transform","opacity"],{duration:e.transitions.duration.shorter}),opacity:1}},staticTooltipClosed:{"& $staticTooltipLabel":{opacity:0,transform:"scale(0.5)"}},staticTooltipLabel:Object(s.a)({position:"absolute"},e.typography.body1,{backgroundColor:e.palette.background.paper,borderRadius:e.shape.borderRadius,boxShadow:e.shadows[1],color:e.palette.text.secondary,padding:"4px 16px",wordBreak:"keep-all"}),tooltipPlacementLeft:{alignItems:"center","& $staticTooltipLabel":{transformOrigin:"100% 50%",right:"100%",marginRight:8}},tooltipPlacementRight:{alignItems:"center","& $staticTooltipLabel":{transformOrigin:"0% 50%",left:"100%",marginLeft:8}}}}),{name:"MuiSpeedDialAction"})(S),M=n("18c2"),P=n.n(M),F=n("64f5"),z=n.n(F),B=n("687f"),$=n("6022"),V=n("bf98"),A=n.n(V);function J(e){var t=e.layer,n=e.layersDataInfo,s=Object(c.b)().enqueueSnackbar,l=Object(o.useState)([]),u=l[0],d=l[1],p=Object(o.useState)(!1),f=p[0],m=p[1];Object(o.useEffect)((function(){var e=t.id,o=n.filter((function(e){return B.c.includes(e.type)})).reduce((function(t,n){var o=n.dataInfo,a=o.dimensions,i=o.paramsValue,r=void 0===i?{underControlLayers:[]}:i,c=o.stringValue,s=r.underControlLayers;if((void 0===s?[]:s).includes(e)){var l={filterType:"=",id:a[0].id,values:c?[].concat(JSON.parse(c).map((function(e){return e.value}))):[]};return[].concat(t,[l])}return t}),[]);d(o)}),[t,n]);var b=Object(o.useCallback)((function(e){var n=Object(i.get)(t.dataInfo,"dataInfo.dimensions",[]),o=Object(i.get)(t.dataInfo,"dataInfo.measures",[]),a=o.length>0?o[0]:n.length>0?n[0]:null;if(a){var c=e.toLowerCase(),l={aggregate:!0,dataset_id:a.model.id,name:Object(i.get)(t.attr,"_title_","下载"),file_type:c,limit:{page_num:0,page_size:Number.MAX_SAFE_INTEGER},filter:{filters:[].concat(u),operatorType:"and",wFilters:[]},dimensions:n,measures:o};$.c.addDownload(l).then((function(e){if("1"===e.status){var n=e.id;s("正在下载中",{variant:"success"}),r.actions.publish.addDownLists({taskId:n,layerId:t.id,fileType:c})}})).catch((function(){s("下载出错",{variant:"error"})})).finally((function(){v()}))}else console.error("未查询到 dataset_id")}),[s,u,t.attr,t.dataInfo,t.id]),v=function(){m(!1)};return a.a.createElement("div",{className:A.a.layerItem},a.a.createElement(w,{ariaLabel:"SpeedDial openIcon",className:A.a.speedDial,direction:"down",icon:a.a.createElement(_,{icon:a.a.createElement(N.a,{title:"数据下载",placement:"left"},a.a.createElement(P.a,null)),openIcon:a.a.createElement(N.a,{title:"数据下载",placement:"left"},a.a.createElement(z.a,null))}),onClose:v,onOpen:function(){m(!0)},open:f},[{icon:"iconexcel",name:"Excel"},{icon:"icontxt",name:"TXT"},{icon:"iconcsv",name:"CSV"}].map((function(e){return a.a.createElement(R,{key:e.name,icon:a.a.createElement("i",{className:"iconfont "+e.icon+" "+A.a.iconBtn}),tooltipTitle:e.name,onClick:function(){return b(e.name)}})}))))}t.default=Object(r.smart)((function(e){return{layersDataInfo:e.layersDataInfo.layersDataInfo}}))(Object(o.memo)(J))},bf98:function(e,t,n){e.exports={layerWrap:"style-module_layerWrap_1Om5m",layerItem:"style-module_layerItem_1JpZ2",speedDial:"style-module_speedDial_3lIbu",iconBtn:"style-module_iconBtn_3Dkpe",btns:"style-module_btns_x4sgf",btn:"style-module_btn_3iFsw"}}}]);